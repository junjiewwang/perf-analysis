# Perf Analysis Service Configuration

# Analysis settings
analysis:
  version: "1.0.0"
  data_dir: "./data"
  max_worker: 5

# Database configuration
database:
  type: postgres  # postgres or mysql
  host: localhost
  port: 5432
  database: perf_analysis
  user: postgres
  password: your_password_here
  max_conns: 10
  # OpenTelemetry tracing is controlled by OTEL_ENABLED environment variable

# Object storage configuration
storage:
  type: local  # cos or local
  # For local storage
  local_path: ./storage
  
  # For COS storage (uncomment and fill in)
  # type: cos
  # bucket: your-bucket-name
  # region: ap-guangzhou
  # secret_id: your-secret-id
  # secret_key: your-secret-key
  # domain: myqcloud.com
  # scheme: https

# APM callback configuration
apm:
  enabled: false
  url: ""
  request_yunapi: true

# Scheduler configuration
scheduler:
  poll_interval: 2  # seconds
  worker_count: 5
  priority_slots: 2  # reserved slots for high-priority tasks
  task_batch_size: 10

# Task sources configuration (Strategy Pattern)
# Each source is a strategy that can be enabled/disabled independently
sources:
  # Database source - polls database for pending tasks
  - type: database
    name: primary-db
    enabled: true
    options:
      poll_interval: 2s    # how often to poll for new tasks
      batch_size: 10       # max tasks to fetch per poll

  # Kafka source - consumes tasks from Kafka topic (optional)
  # - type: kafka
  #   name: kafka-tasks
  #   enabled: false
  #   options:
  #     brokers:
  #       - localhost:9092
  #     topic: perf-tasks
  #     consumer_group: perf-analyzer
  #     auto_commit: false
  #     max_poll_records: 100

  # HTTP source - receives tasks via HTTP webhook (optional)
  # - type: http
  #   name: http-webhook
  #   enabled: false
  #   options:
  #     listen_addr: ":8081"
  #     path: /tasks
  #     read_timeout: 30s
  #     write_timeout: 30s
  #     max_body_size: 1048576  # 1MB


# Logging configuration
log:
  level: info  # debug, info, warn, error
  output_path: ./logs
  format: text  # text or json

# Pprof configuration (for service self-profiling)
pprof:
  enabled: false
  mode: http  # file or http
  output_dir: ./pprof
  profiles:
    - cpu
    - heap
    - goroutine
  # File mode configuration (for periodic snapshots)
  file:
    interval: 30s
    cpu_duration: 10s
    cpu_rate: 100
    max_file_size: 104857600  # 100MB
    max_files: 10
    auto_rotate: true
  # HTTP mode configuration (for on-demand profiling)
  http:
    addr: ":6060"
    path: "/debug/pprof"
    enable_ui: true
    save_to_file: false
    default_seconds: 30
    # Authentication (optional)
    # auth:
    #   enabled: true
    #   username: admin
    #   password: secret
    #   # Or use token-based auth
    #   # token: your-secret-token
